<!DOCTYPE html>
<html lang="en">
<head>
    <title>Thời gian JIRA sang tiếng</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/plugins/bootstrap/bootstrap.min.css">
    <script src="/plugins/jquery/jquery.min.js"></script>
    <script src="/plugins/bootstrap/bootstrap.min.js"></script>

    <script src="js/common.js"></script>
</head>
<body>

<div class="container">
    <h2>Nhập thời gian</h2>

    <div class="form-group">
        <input class="form-control" id="text_in" placeholder="Ví dụ: 1w 1d 4h 11m">
    </div>

    <div class="form-group">
        <button class="btn btn-success" id="btn_start">Start</button>
    </div>

    <div class="form-group">
        <ul id="details"></ul>
        <hr />
        <h4 class="text-success" id="result"></h4>
    </div>
</div>

<script>
    $('#btn_start').click(function() {
        let input = $('#text_in').val().trim();
        $('#details').html('');
        $('#result').text('');

        if (!input) {
            $('#details').append('<li class="text-warning">Không có input</li>');
            return;
        }

        // regex bắt cặp: số + unit (w|d|h|m), không phân biệt hoa thường, cho phép khoảng trắng giữa
        const re = /(\d+)\s*(w|d|h|m)/gi;
        let weeks = 0, days = 0, hours = 0, minutes = 0;
        let found = false;

        // dùng matchAll để lấy tất cả kết quả
        for (const m of input.matchAll(re)) {
            found = true;
            const num = parseInt(m[1], 10);
            const unit = m[2].toLowerCase();

            if (unit === 'w') weeks += num;
            else if (unit === 'd') days += num;
            else if (unit === 'h') hours += num;
            else if (unit === 'm') minutes += num;
        }

        if (!found) {
            $('#details').append('<li class="text-danger">Không tìm thấy định dạng hợp lệ (vd: 1w 1d 4h 11m)</li>');
            return;
        }

        // Quy đổi: 1w = 5d = 40h, 1d = 8h
        const totalMinutes =
            weeks * 40 * 60 +
            days * 8 * 60 +
            hours * 60 +
            minutes;

        const totalHoursDecimal = totalMinutes / 60; // số giờ thập phân
        const totalHours = Math.floor(totalMinutes / 60);
        const remMinutes = totalMinutes % 60;

        $('#details').append(`
            <li>Parsed: Weeks: ${weeks}, Days: ${days}, Hours: ${hours}, Minutes: ${minutes}</li>
        `);

        $('#result').text(`${totalMinutes}m - ${totalHoursDecimal.toFixed(2)}h  (tương đương ${totalHours}h ${remMinutes}m)`);
    });
</script>

</body>
</html>
